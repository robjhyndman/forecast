<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>k-fold Cross-Validation applied to an autoregressive model — CVar • forecast</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="k-fold Cross-Validation applied to an autoregressive model — CVar"><meta property="og:description" content="CVar computes the errors obtained by applying an autoregressive
modelling function to subsets of the time series y using k-fold
cross-validation as described in Bergmeir, Hyndman and Koo (2015). It also
applies a Ljung-Box test to the residuals. If this test is significant
(see returned pvalue), there is serial correlation in the residuals and the
model can be considered to be underfitting the data. In this case, the
cross-validated errors can underestimate the generalization error and should
not be used."><meta property="og:image" content="/logo.png"><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">forecast</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">8.19.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="https://cran.r-project.org/web/packages/forecast/vignettes/JSS2008.pdf" class="external-link">JSS paper</a>
</li>
<li>
  <a href="../news/index.html">Change Log</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/robjhyndman/forecast" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>k-fold Cross-Validation applied to an autoregressive model</h1>
    <small class="dont-index">Source: <a href="https://github.com/robjhyndman/forecast/blob/HEAD/R/tscv.R" class="external-link"><code>R/tscv.R</code></a></small>
    <div class="hidden name"><code>CVar.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>CVar</code> computes the errors obtained by applying an autoregressive
modelling function to subsets of the time series <code>y</code> using k-fold
cross-validation as described in Bergmeir, Hyndman and Koo (2015). It also
applies a Ljung-Box test to the residuals. If this test is significant
(see returned pvalue), there is serial correlation in the residuals and the
model can be considered to be underfitting the data. In this case, the
cross-validated errors can underestimate the generalization error and should
not be used.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">CVar</span><span class="op">(</span></span>
<span>  <span class="va">y</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  FUN <span class="op">=</span> <span class="va">nnetar</span>,</span>
<span>  cvtrace <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  blocked <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  LBlags <span class="op">=</span> <span class="fl">24</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>y</dt>
<dd><p>Univariate time series</p></dd>


<dt>k</dt>
<dd><p>Number of folds to use for cross-validation.</p></dd>


<dt>FUN</dt>
<dd><p>Function to fit an autoregressive model. Currently, it only works
with the <code><a href="nnetar.html">nnetar</a></code> function.</p></dd>


<dt>cvtrace</dt>
<dd><p>Provide progress information.</p></dd>


<dt>blocked</dt>
<dd><p>choose folds randomly or as blocks?</p></dd>


<dt>LBlags</dt>
<dd><p>lags for the Ljung-Box test, defaults to 24, for yearly series can be set to 20</p></dd>


<dt>...</dt>
<dd><p>Other arguments are passed to <code>FUN</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A list containing information about the model and accuracy for each
fold, plus other summary information computed across folds.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Bergmeir, C., Hyndman, R.J., Koo, B. (2018) A note on the
validity of cross-validation for evaluating time series prediction.
<em>Computational Statistics &amp; Data Analysis</em>, <b>120</b>, 70-83.
<a href="https://robjhyndman.com/publications/cv-time-series/" class="external-link">https://robjhyndman.com/publications/cv-time-series/</a>.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><a href="CV.html">CV</a>, <a href="tsCV.html">tsCV</a>.</p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Gabriel Caceres and Rob J Hyndman</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">modelcv</span> <span class="op">&lt;-</span> <span class="fu">CVar</span><span class="op">(</span><span class="va">lynx</span>, k<span class="op">=</span><span class="fl">5</span>, lambda<span class="op">=</span><span class="fl">0.15</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">modelcv</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Series: lynx </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:   CVar(y = lynx, k = 5, lambda = 0.15)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5-fold cross-validation</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    Mean          SD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ME        -114.74017030 380.1734875</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RMSE      1091.95530993 394.8588873</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MAE        699.01714953 243.7372853</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MPE        -40.19090618  41.2933429</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MAPE        74.96821955  28.7461356</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ACF1         0.09796346   0.2773315</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Theil's U    0.87330712   0.2761264</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p-value of Ljung-Box test of residuals is  0.08462048 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> if this value is significant (&lt;0.05),</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> the result of the cross-validation should not be used</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> as the model is underfitting the data.</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">modelcv</span><span class="op">$</span><span class="va">fold1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $model</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Series: y </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model:  NNAR(11,6) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:   FUN(y = y, lambda = 0.15, subset = trainset)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Average of 20 networks, each of which is</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a 11-6-1 network with 79 weights</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> options were - linear output units </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma^2 estimated as 0.06272</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $accuracy</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                ME     RMSE      MAE       MPE     MAPE      ACF1 Theil's U</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Test set -640.462 1735.663 1057.485 -61.84383 84.87237 0.4672295  1.202423</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $testfit</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time Series:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Start = 1821 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> End = 1934 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Frequency = 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [1]         NA         NA         NA         NA         NA         NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [7]         NA         NA         NA         NA         NA  102.02550</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [13]  170.45608  282.68378  415.70554 1036.22234 2868.09265 3450.91326</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [19] 1836.43527  411.78455  159.69458   46.24531   66.07433  210.74890</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [25]  544.87814 1014.89954 3533.93928 2609.89430  960.73271  361.33532</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [31]  364.23530  235.53255  361.04642  732.57626 1631.78856 2820.52043</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [37] 2976.54516 2112.05580  691.42077  285.13218  459.77682  233.72014</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [43]  536.40418 1065.28832 3213.48190 6598.91381 4261.71817  713.82319</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [49]  248.29438  435.01505  365.68095  781.52843 1601.08609 1729.29502</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [55] 1991.63945 1425.31753  425.24597  300.57961  205.84869  228.89885</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [61]  455.98020  761.62179 2093.36256 4592.15906 4205.94588 2541.25147</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [67]  413.23983   78.23818   40.21715   51.68530   62.85866  193.58660</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [73]  380.00313 1264.12093 3912.62138 3409.46579  595.93680  107.88611</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [79]  154.81874  380.12897  744.26458 1590.69921 3370.48853 2070.17208</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [85] 2207.61931 3676.08179 1790.77360  354.52629  372.76503  805.14694</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [91] 1333.81417 2727.08412 3611.66109 3040.74239  975.71375  609.80877</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [97]  700.19368   82.32865  100.96111  110.20690  226.32194  789.38055</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [103] 1118.02525 2426.41926 3479.15457 3011.29027 1487.08031  283.15185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [109]  474.42306  740.29402 1037.28544 1776.83848 2185.21442 2903.68946</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $testset</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]   5  10  16  21  27  35  41  44  55  57  64  82  84  85  95  96  99 102 108</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [20] 110 112 113 114</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">lynx</span>, series<span class="op">=</span><span class="st">"Data"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="autolayer.html">autolayer</a></span><span class="op">(</span><span class="va">modelcv</span><span class="op">$</span><span class="va">testfit</span>, series<span class="op">=</span><span class="st">"Fits"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="autolayer.html">autolayer</a></span><span class="op">(</span><span class="va">modelcv</span><span class="op">$</span><span class="va">residuals</span>, series<span class="op">=</span><span class="st">"Residuals"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Removed 11 rows containing missing values (`geom_line()`).</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Removed 11 rows containing missing values (`geom_line()`).</span>
<span class="r-plt img"><img src="CVar-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="autoplot.acf.html">ggAcf</a></span><span class="op">(</span><span class="va">modelcv</span><span class="op">$</span><span class="va">residuals</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="CVar-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="http://robjhyndman.com" class="external-link">Rob Hyndman</a>, George Athanasopoulos, <a href="https://github.com/cbergmeir" class="external-link">Christoph Bergmeir</a>, <a href="https://github.com/gabrielcaceres" class="external-link">Gabriel Caceres</a>, Leanne Chhay, Kirill Kuroptev, <a href="https://github.com/mitchelloharawild" class="external-link">Mitchell O’Hara-Wild</a>, <a href="http://fpetropoulos.eu" class="external-link">Fotios Petropoulos</a>, <a href="https://github.com/slavarazbash" class="external-link">Slava Razbash</a>, <a href="http://earo.me" class="external-link">Earo Wang</a>, Farah Yasmeen.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>


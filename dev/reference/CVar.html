<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>k-fold Cross-Validation applied to an autoregressive model — CVar • forecast</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="k-fold Cross-Validation applied to an autoregressive model — CVar"><meta property="og:description" content="CVar computes the errors obtained by applying an autoregressive
modelling function to subsets of the time series y using k-fold
cross-validation as described in Bergmeir, Hyndman and Koo (2015). It also
applies a Ljung-Box test to the residuals. If this test is significant
(see returned pvalue), there is serial correlation in the residuals and the
model can be considered to be underfitting the data. In this case, the
cross-validated errors can underestimate the generalization error and should
not be used."><meta property="og:image" content="/logo.png"><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">forecast</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">8.19.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="https://cran.r-project.org/web/packages/forecast/vignettes/JSS2008.pdf" class="external-link">JSS paper</a>
</li>
<li>
  <a href="../news/index.html">Change Log</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/robjhyndman/forecast" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>k-fold Cross-Validation applied to an autoregressive model</h1>
    <small class="dont-index">Source: <a href="https://github.com/robjhyndman/forecast/blob/HEAD/R/tscv.R" class="external-link"><code>R/tscv.R</code></a></small>
    <div class="hidden name"><code>CVar.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>CVar</code> computes the errors obtained by applying an autoregressive
modelling function to subsets of the time series <code>y</code> using k-fold
cross-validation as described in Bergmeir, Hyndman and Koo (2015). It also
applies a Ljung-Box test to the residuals. If this test is significant
(see returned pvalue), there is serial correlation in the residuals and the
model can be considered to be underfitting the data. In this case, the
cross-validated errors can underestimate the generalization error and should
not be used.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">CVar</span><span class="op">(</span></span>
<span>  <span class="va">y</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  FUN <span class="op">=</span> <span class="va">nnetar</span>,</span>
<span>  cvtrace <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  blocked <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  LBlags <span class="op">=</span> <span class="fl">24</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>y</dt>
<dd><p>Univariate time series</p></dd>


<dt>k</dt>
<dd><p>Number of folds to use for cross-validation.</p></dd>


<dt>FUN</dt>
<dd><p>Function to fit an autoregressive model. Currently, it only works
with the <code><a href="nnetar.html">nnetar</a></code> function.</p></dd>


<dt>cvtrace</dt>
<dd><p>Provide progress information.</p></dd>


<dt>blocked</dt>
<dd><p>choose folds randomly or as blocks?</p></dd>


<dt>LBlags</dt>
<dd><p>lags for the Ljung-Box test, defaults to 24, for yearly series can be set to 20</p></dd>


<dt>...</dt>
<dd><p>Other arguments are passed to <code>FUN</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A list containing information about the model and accuracy for each
fold, plus other summary information computed across folds.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Bergmeir, C., Hyndman, R.J., Koo, B. (2018) A note on the
validity of cross-validation for evaluating time series prediction.
<em>Computational Statistics &amp; Data Analysis</em>, <b>120</b>, 70-83.
<a href="https://robjhyndman.com/publications/cv-time-series/" class="external-link">https://robjhyndman.com/publications/cv-time-series/</a>.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><a href="CV.html">CV</a>, <a href="tsCV.html">tsCV</a>.</p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Gabriel Caceres and Rob J Hyndman</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">modelcv</span> <span class="op">&lt;-</span> <span class="fu">CVar</span><span class="op">(</span><span class="va">lynx</span>, k<span class="op">=</span><span class="fl">5</span>, lambda<span class="op">=</span><span class="fl">0.15</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">modelcv</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Series: lynx </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:   CVar(y = lynx, k = 5, lambda = 0.15)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5-fold cross-validation</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   Mean          SD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ME        -155.5436190 317.3328203</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RMSE       987.4893918 216.2519879</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MAE        610.2448468 117.8289779</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MPE        -28.9237362  22.7400877</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MAPE        61.1495083  18.0606473</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ACF1        -0.1390840   0.2698244</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Theil's U    0.9596969   0.6337667</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p-value of Ljung-Box test of residuals is  0.7859724 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> if this value is significant (&lt;0.05),</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> the result of the cross-validation should not be used</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> as the model is underfitting the data.</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">modelcv</span><span class="op">$</span><span class="va">fold1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $model</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Series: y </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model:  NNAR(11,6) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:   FUN(y = y, lambda = 0.15, subset = trainset)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Average of 20 networks, each of which is</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a 11-6-1 network with 79 weights</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> options were - linear output units </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma^2 estimated as 0.08434</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $accuracy</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 ME     RMSE      MAE       MPE     MAPE      ACF1 Theil's U</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Test set -454.4073 1119.844 708.0528 -63.61115 85.06339 0.1589167 0.4415375</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $testfit</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time Series:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Start = 1821 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> End = 1934 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Frequency = 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [1]         NA         NA         NA         NA         NA         NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [7]         NA         NA         NA         NA         NA  104.44533</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [13]   33.36737  433.59620  403.83920 2260.56221 2853.05777 3106.85480</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [19] 2081.26034  411.92954  152.48092   49.53722   67.84627  207.32834</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [25]  544.03323 1085.13039 2231.58803 4317.51258  941.90439  363.39555</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [31]  386.36821  402.83446  358.64102  722.89977 1606.55286 2822.71975</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [37] 3210.17007 2112.67570  504.95824  285.18331  248.02692  242.59949</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [43]  532.41272 1539.61682 3086.64285 3603.58060 3840.97811  705.25843</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [49]  247.98178  416.27948  370.09535  692.09150 1631.16779 1702.48646</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [55] 2320.61913 1915.06342  753.24133  304.32781  200.66838  230.02980</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [61]  475.00338  776.12369 2095.31457 3057.19884 4057.42008 2536.66883</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [67]  394.22838   82.03310   64.71932   49.46424   63.14596  188.04470</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [73]  371.91564 1260.59645 3804.13024 3471.71684  589.95536  196.75589</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [79]  151.58191  237.69285  717.87654 1297.34940 3372.38144 6827.93704</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [85] 3394.00489 3617.98674  414.31352  363.36281  353.46000  596.28770</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [91]  902.95979 1709.40934 3439.66766 3184.07999 2306.14321 3484.99375</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [97]  683.14290   82.24621   77.97478  108.74209  223.67906  401.43140</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [103]  945.90994 2460.35043 3614.38806 2213.12459  368.24019  520.08030</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [109]  488.34443  659.21258  999.44686 1590.39133 2865.48099 3449.40049</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $testset</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]   1  13  14  18  28  32  39  46  52  55  56  69  78  80  85  87  90  91  92</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [20]  95 103 106 107</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">lynx</span>, series<span class="op">=</span><span class="st">"Data"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="autolayer.html">autolayer</a></span><span class="op">(</span><span class="va">modelcv</span><span class="op">$</span><span class="va">testfit</span>, series<span class="op">=</span><span class="st">"Fits"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="autolayer.html">autolayer</a></span><span class="op">(</span><span class="va">modelcv</span><span class="op">$</span><span class="va">residuals</span>, series<span class="op">=</span><span class="st">"Residuals"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Removed 11 rows containing missing values (`geom_line()`).</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Removed 11 rows containing missing values (`geom_line()`).</span>
<span class="r-plt img"><img src="CVar-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="autoplot.acf.html">ggAcf</a></span><span class="op">(</span><span class="va">modelcv</span><span class="op">$</span><span class="va">residuals</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="CVar-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="http://robjhyndman.com" class="external-link">Rob Hyndman</a>, George Athanasopoulos, <a href="https://github.com/cbergmeir" class="external-link">Christoph Bergmeir</a>, <a href="https://github.com/gabrielcaceres" class="external-link">Gabriel Caceres</a>, Leanne Chhay, Kirill Kuroptev, <a href="https://github.com/mitchelloharawild" class="external-link">Mitchell O’Hara-Wild</a>, <a href="http://fpetropoulos.eu" class="external-link">Fotios Petropoulos</a>, <a href="https://github.com/slavarazbash" class="external-link">Slava Razbash</a>, <a href="http://earo.me" class="external-link">Earo Wang</a>, Farah Yasmeen.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>


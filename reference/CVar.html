<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>k-fold Cross-Validation applied to an autoregressive model — CVar • forecast</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="k-fold Cross-Validation applied to an autoregressive model — CVar"><meta property="og:description" content="CVar computes the errors obtained by applying an autoregressive
modelling function to subsets of the time series y using k-fold
cross-validation as described in Bergmeir, Hyndman and Koo (2015). It also
applies a Ljung-Box test to the residuals. If this test is significant
(see returned pvalue), there is serial correlation in the residuals and the
model can be considered to be underfitting the data. In this case, the
cross-validated errors can underestimate the generalization error and should
not be used."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">forecast</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">8.21</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="https://cran.r-project.org/web/packages/forecast/vignettes/JSS2008.pdf" class="external-link">JSS paper</a>
</li>
<li>
  <a href="../news/index.html">Change Log</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/robjhyndman/forecast" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>k-fold Cross-Validation applied to an autoregressive model</h1>
    <small class="dont-index">Source: <a href="https://github.com/robjhyndman/forecast/blob/HEAD/R/tscv.R" class="external-link"><code>R/tscv.R</code></a></small>
    <div class="hidden name"><code>CVar.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>CVar</code> computes the errors obtained by applying an autoregressive
modelling function to subsets of the time series <code>y</code> using k-fold
cross-validation as described in Bergmeir, Hyndman and Koo (2015). It also
applies a Ljung-Box test to the residuals. If this test is significant
(see returned pvalue), there is serial correlation in the residuals and the
model can be considered to be underfitting the data. In this case, the
cross-validated errors can underestimate the generalization error and should
not be used.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">CVar</span><span class="op">(</span></span>
<span>  <span class="va">y</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  FUN <span class="op">=</span> <span class="va">nnetar</span>,</span>
<span>  cvtrace <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  blocked <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  LBlags <span class="op">=</span> <span class="fl">24</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>y</dt>
<dd><p>Univariate time series</p></dd>


<dt>k</dt>
<dd><p>Number of folds to use for cross-validation.</p></dd>


<dt>FUN</dt>
<dd><p>Function to fit an autoregressive model. Currently, it only works
with the <code><a href="nnetar.html">nnetar</a></code> function.</p></dd>


<dt>cvtrace</dt>
<dd><p>Provide progress information.</p></dd>


<dt>blocked</dt>
<dd><p>choose folds randomly or as blocks?</p></dd>


<dt>LBlags</dt>
<dd><p>lags for the Ljung-Box test, defaults to 24, for yearly series can be set to 20</p></dd>


<dt>...</dt>
<dd><p>Other arguments are passed to <code>FUN</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A list containing information about the model and accuracy for each
fold, plus other summary information computed across folds.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Bergmeir, C., Hyndman, R.J., Koo, B. (2018) A note on the
validity of cross-validation for evaluating time series prediction.
<em>Computational Statistics &amp; Data Analysis</em>, <b>120</b>, 70-83.
<a href="https://robjhyndman.com/publications/cv-time-series/" class="external-link">https://robjhyndman.com/publications/cv-time-series/</a>.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><a href="CV.html">CV</a>, <a href="tsCV.html">tsCV</a>.</p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Gabriel Caceres and Rob J Hyndman</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">modelcv</span> <span class="op">&lt;-</span> <span class="fu">CVar</span><span class="op">(</span><span class="va">lynx</span>, k<span class="op">=</span><span class="fl">5</span>, lambda<span class="op">=</span><span class="fl">0.15</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">modelcv</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Series: lynx </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:   CVar(y = lynx, k = 5, lambda = 0.15)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5-fold cross-validation</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   Mean          SD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ME          2.08101124 276.5463609</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RMSE      976.87293288 270.3766773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MAE       642.06965036 143.9377837</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MPE       -21.98485725  16.8534727</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MAPE       60.50622529  18.8311874</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ACF1        0.04490266   0.1364704</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Theil's U   0.98642532   0.3505911</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> p-value of Ljung-Box test of residuals is  0.3251919 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> if this value is significant (&lt;0.05),</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> the result of the cross-validation should not be used</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> as the model is underfitting the data.</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">modelcv</span><span class="op">$</span><span class="va">fold1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $model</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Series: y </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model:  NNAR(11,6) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:   FUN(y = y, lambda = 0.15, subset = trainset)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Average of 20 networks, each of which is</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a 11-6-1 network with 79 weights</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> options were - linear output units </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigma^2 estimated as 0.1061</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $accuracy</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 ME     RMSE      MAE       MPE     MAPE      ACF1 Theil's U</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Test set -137.2584 1242.124 733.4557 -16.23863 43.65241 0.1978185  0.821217</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $testfit</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time Series:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Start = 1821 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> End = 1934 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Frequency = 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [1]         NA         NA         NA         NA         NA         NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [7]         NA         NA         NA         NA         NA  106.42993</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [13]  166.01953  304.09750  416.50293 2208.35640 2785.68234 3583.53384</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [19] 1944.48678  417.72916  152.98264   48.29158   68.52339  145.38683</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [25]  551.16318 1047.14505 2197.49655 2567.33893  976.43186  367.89685</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [31]  361.83790  251.97004  359.94622 1121.20473 1550.47670 2735.04290</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [37] 4240.29170 2187.88689  660.00185  289.51215  253.78630  235.37709</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [43]  545.14520 1538.40861 3436.87921 6046.44832 7530.62195  683.76532</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [49]  247.74867  456.10861  368.27171  389.01671 1595.44908 1859.69367</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [55] 2283.03922 1529.56703  758.44405  303.09831  201.95552  231.18313</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [61]  453.37021  794.12813 2053.34506 2899.43068 4328.72508 2622.41144</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [67]  400.71467   76.40272   39.93800  121.16087   61.50806  186.51212</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [73]  378.21577 1318.57735 3782.80218 3499.42086  588.65125  109.64084</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [79]  152.49395  370.85571  735.85864 1279.86914 3279.05562 3605.82493</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [85] 6241.35096 2138.45195  801.63827  479.01653  368.11793  769.99907</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [91]  779.97480 2799.30440 3545.23633 3108.75149 2959.64323 3473.69287</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [97]  699.01603   81.72192   85.17569  227.18305  229.65832  414.83848</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [103] 1138.56565 2367.45619 3430.33049 2898.86615 1466.60423  487.97204</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [109]  459.03766  645.74115 1018.39814 1568.67679 2643.80527 2603.39024</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $testset</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1]   2   5   9  11  18  21  24  34  35  37  45  47  52  65  70  84  86  87  88</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [20]  91 100 105 114</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">lynx</span>, series<span class="op">=</span><span class="st">"Data"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="autolayer.html">autolayer</a></span><span class="op">(</span><span class="va">modelcv</span><span class="op">$</span><span class="va">testfit</span>, series<span class="op">=</span><span class="st">"Fits"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="autolayer.html">autolayer</a></span><span class="op">(</span><span class="va">modelcv</span><span class="op">$</span><span class="va">residuals</span>, series<span class="op">=</span><span class="st">"Residuals"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Removed 11 rows containing missing values (`geom_line()`).</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Removed 11 rows containing missing values (`geom_line()`).</span>
<span class="r-plt img"><img src="CVar-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="autoplot.acf.html">ggAcf</a></span><span class="op">(</span><span class="va">modelcv</span><span class="op">$</span><span class="va">residuals</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="CVar-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="http://robjhyndman.com" class="external-link">Rob Hyndman</a>, George Athanasopoulos, <a href="https://github.com/cbergmeir" class="external-link">Christoph Bergmeir</a>, <a href="https://github.com/gabrielcaceres" class="external-link">Gabriel Caceres</a>, Leanne Chhay, Kirill Kuroptev, <a href="https://github.com/mitchelloharawild" class="external-link">Mitchell O’Hara-Wild</a>, <a href="http://fpetropoulos.eu" class="external-link">Fotios Petropoulos</a>, <a href="https://github.com/slavarazbash" class="external-link">Slava Razbash</a>, <a href="http://earo.me" class="external-link">Earo Wang</a>, Farah Yasmeen.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

